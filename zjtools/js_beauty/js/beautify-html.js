function style_html(L,J){var C,B,P,R,K;J=J||{};B=J.indent_size||4;P=J.indent_char||" ";K=J.brace_style||"collapse";R=J.max_char==0?Infinity:J.max_char||70;unformatted=J.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];function O(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(U,T){for(var V=0;V<T.length;V++){if(U===T[V]){return true}}return false}};this.get_content=function(){var T="",U=[],W=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return U.length?U.join(""):["","TK_EOF"]}T=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(T,this.Utils.whitespace)){if(U.length){W=true}this.line_char_count--;continue}else{if(W){if(this.line_char_count>=this.max_char){U.push("\n");for(var V=0;V<this.indent_level;V++){U.push(this.indent_string)}this.line_char_count=0}else{U.push(" ");this.line_char_count++}W=false}}U.push(T)}return U.length?U.join(""):""};this.get_contents_to=function(U){if(this.pos==this.input.length){return["","TK_EOF"]}var T="";var V="";var X=new RegExp("</"+U+"\\s*>","igm");X.lastIndex=this.pos;var W=X.exec(this.input);var Y=W?W.index:this.input.length;if(this.pos<Y){V=this.input.substring(this.pos,Y);this.pos=Y}return V};this.record_tag=function(T){if(this.tags[T+"count"]){this.tags[T+"count"]++;this.tags[T+this.tags[T+"count"]]=this.indent_level}else{this.tags[T+"count"]=1;this.tags[T+this.tags[T+"count"]]=this.indent_level}this.tags[T+this.tags[T+"count"]+"parent"]=this.tags.parent;this.tags.parent=T+this.tags[T+"count"]};this.retrieve_tag=function(T){if(this.tags[T+"count"]){var U=this.tags.parent;while(U){if(T+this.tags[T+"count"]===U){break}U=this.tags[U+"parent"]}if(U){this.indent_level=this.tags[T+this.tags[T+"count"]];this.tags.parent=this.tags[U+"parent"]}delete this.tags[T+this.tags[T+"count"]+"parent"];delete this.tags[T+this.tags[T+"count"]];if(this.tags[T+"count"]==1){delete this.tags[T+"count"]}else{this.tags[T+"count"]--}}};this.get_tag=function(){var X="",a=[],Y=false,b,Z;do{if(this.pos>=this.input.length){return a.length?a.join(""):["","TK_EOF"]}X=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(X,this.Utils.whitespace)){Y=true;this.line_char_count--;continue}if(X==="'"||X==='"'){if(!a[1]||a[1]!=="!"){X+=this.get_unformatted(X);Y=true}}if(X==="="){Y=false}if(a.length&&a[a.length-1]!=="="&&X!==">"&&Y){if(this.line_char_count>=this.max_char){this.print_newline(false,a);this.line_char_count=0}else{a.push(" ");this.line_char_count++}Y=false}if(X==="<"){b=this.pos-1}a.push(X)}while(X!==">");var V=a.join("");var W;if(V.indexOf(" ")!=-1){W=V.indexOf(" ")}else{W=V.indexOf(">")}var T=V.substring(1,W).toLowerCase();if(V.charAt(V.length-2)==="/"||this.Utils.in_array(T,this.Utils.single_token)){this.tag_type="SINGLE"}else{if(T==="script"){this.record_tag(T);this.tag_type="SCRIPT"}else{if(T==="style"){this.record_tag(T);this.tag_type="STYLE"}else{if(this.Utils.in_array(T,unformatted)){var U=this.get_unformatted("</"+T+">",V);a.push(U);if(b>0&&this.Utils.in_array(this.input.charAt(b-1),this.Utils.whitespace)){a.splice(0,0,this.input.charAt(b-1))}Z=this.pos-1;if(this.Utils.in_array(this.input.charAt(Z+1),this.Utils.whitespace)){a.push(this.input.charAt(Z+1))}this.tag_type="SINGLE"}else{if(T.charAt(0)==="!"){if(T.indexOf("[if")!=-1){if(V.indexOf("!IE")!=-1){var U=this.get_unformatted("-->",V);a.push(U)}this.tag_type="START"}else{if(T.indexOf("[endif")!=-1){this.tag_type="END";this.unindent()}else{if(T.indexOf("[cdata[")!=-1){var U=this.get_unformatted("]]>",V);a.push(U);this.tag_type="SINGLE"}else{var U=this.get_unformatted("-->",V);a.push(U);this.tag_type="SINGLE"}}}}else{if(T.charAt(0)==="/"){this.retrieve_tag(T.substring(1));this.tag_type="END"}else{this.record_tag(T);this.tag_type="START"}if(this.Utils.in_array(T,this.Utils.extra_liners)){this.print_newline(true,this.output)}}}}}}return a.join("")};this.get_unformatted=function(V,X){if(X&&X.indexOf(V)!=-1){return""}var T="";var U="";var W=true;do{if(this.pos>=this.input.length){return U}T=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(T,this.Utils.whitespace)){if(!W){this.line_char_count--;continue}if(T==="\n"||T==="\r"){U+="\n";this.line_char_count=0;continue}}U+=T;this.line_char_count++;W=true}while(U.indexOf(V)==-1);return U};this.get_token=function(){var V;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var T=this.last_token.substr(7);V=this.get_contents_to(T);if(typeof V!=="string"){return V}return[V,"TK_"+T]}if(this.current_mode==="CONTENT"){V=this.get_content();if(typeof V!=="string"){return V}else{return[V,"TK_CONTENT"]}}if(this.current_mode==="TAG"){V=this.get_tag();if(typeof V!=="string"){return V}else{var U="TK_TAG_"+this.tag_type;return[V,U]}}};this.get_full_indent=function(T){T=this.indent_level+T||0;if(T<1){return""}return Array(T+1).join(this.indent_string)};this.printer=function(Y,V,T,W,X){this.input=Y||"";this.output=[];this.indent_character=V;this.indent_string="";this.indent_size=T;this.brace_style=X;this.indent_level=0;this.max_char=W;this.line_char_count=0;for(var U=0;U<this.indent_size;U++){this.indent_string+=this.indent_character}this.print_newline=function(a,Z){this.line_char_count=0;if(!Z||!Z.length){return}if(!a){while(this.Utils.in_array(Z[Z.length-1],this.Utils.whitespace)){Z.pop()}}Z.push("\n");for(var b=0;b<this.indent_level;b++){Z.push(this.indent_string)}};this.print_token=function(Z){this.output.push(Z)};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this}C=new O();C.printer(L,P,B,R,K);while(true){var G=C.get_token();C.token_text=G[0];C.token_type=G[1];if(C.token_type==="TK_EOF"){break}switch(C.token_type){case"TK_TAG_START":C.print_newline(false,C.output);C.print_token(C.token_text);C.indent();C.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":C.print_newline(false,C.output);C.print_token(C.token_text);C.current_mode="CONTENT";break;case"TK_TAG_END":if(C.last_token==="TK_CONTENT"&&C.last_text===""){var F=C.token_text.match(/\w+/)[0];var N=C.output[C.output.length-1].match(/<\s*(\w+)/);if(N===null||N[1]!==F){C.print_newline(true,C.output)}}C.print_token(C.token_text);C.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var D=C.token_text.match(/^\s*<([a-z]+)/i);if(!D||!C.Utils.in_array(D[1],unformatted)){C.print_newline(false,C.output)}C.print_token(C.token_text);C.current_mode="CONTENT";break;case"TK_CONTENT":if(C.token_text!==""){C.print_token(C.token_text)}C.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(C.token_text!==""){C.output.push("\n");var A=C.token_text;if(C.token_type=="TK_SCRIPT"){var M=typeof js_beautify=="function"&&js_beautify}else{if(C.token_type=="TK_STYLE"){var M=typeof css_beautify=="function"&&css_beautify}}if(J.indent_scripts=="keep"){var S=0}else{if(J.indent_scripts=="separate"){var S=-C.indent_level}else{var S=1}}var H=C.get_full_indent(S);if(M){A=M(A.replace(/^\s*/,H),J)}else{var E=A.match(/^\s*/)[0];var I=E.match(/[^\n\r]*$/)[0].split(C.indent_string).length-1;var Q=C.get_full_indent(S-I);A=A.replace(/^\s*/,H).replace(/\r\n|\r|\n/g,"\n"+Q).replace(/\s*$/,"")}if(A){C.print_token(A);C.print_newline(true,C.output)}}C.current_mode="TAG";break}C.last_token=C.token_type;C.last_text=C.token_text}return C.output.join("")};